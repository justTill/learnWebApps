extends ../layout

block content

    h1 Auf neue Probleme Antworten
    each problem in unansweredProblems
        div
            span <b> #{problem.moodlename} </b> hat ein Problem beim Aufgabe <b> #{problem.lessonname} </b>
            button(type="button" class="btn btn-primary" data-toggle="modal" data-target="#answerModal" data-problemlessonname="#{problem.lessonname}" data-problemmessage="#{problem.message}" data-problemid="#{problem.id}" data-problemmoodlename="#{problem.moodlename}" data-problemmoodleid="#{problem.moodleid}") Antworten
    div
        div(class="modal fade" id="answerModal" tabindex="-1" role="dialog" aria-hidden="true")
            div(class="modal-dialog modal-dialog-centered" role="document")
                div(class="modal-content")
                    div(class="modal-header")
                        h5(class="modal-title") Antworten
                        button(type="button" class="close" data-dismiss="modal" aria-label="Close")
                            span(aria-hidden="true") &times;
                    div(class="modal-body")
                        form(action="/saveAnswerOnProblem" method="post")
                            input(class="modalProblemId" type="hidden" name="problemId")
                            input(class="modalProblemMoodleId" type="hidden" name="moodleId")
                            div.input
                                span.label(class="form-lessonName") Nachrichten Text
                                br
                                span.label(class="form-message") Nachrichten Text
                                br
                                textarea(name="answer" value="" required)
                            div.actions
                                button(class="btn btn-primary" type="submit") Senden
    script.
        $('#answerModal').on('show.bs.modal', function (event) {
            let button = $(event.relatedTarget)
            let problemId = button.data('problemid')
            let problemMoodleId = button.data('problemmoodleid')
            let problemMoodleName = button.data('problemmoodlename')
            let problemLessonName = button.data('problemlessonname')
            let problemMessage = button.data('problemmessage')
            let modal = $(this)
            modal.find('.modal-title').text(problemMoodleName + " Antworten")
            modal.find('.modalProblemId').val(problemId)
            modal.find('.form-lessonName').text('Aufgabe: ' + problemLessonName)
            modal.find('.form-message').text('Frage: ' + problemMessage)
            modal.find('.modalProblemMoodleId').val(problemMoodleId)
        })

    h1 Antworten auf Probleme bearbeiten
    each key in answeredProblemKeys
        b Meldungen vom #{key}
        br
        each problem in answeredProblems.get(key)
            div Problem von <b> #{problem.moodlename} </b> bei der Aufgabe <b> #{problem.lessonname}</b>
                div
                    button(class="btn btn-primary" type="button" data-toggle="modal" data-target="#problemEditModal"
                        data-problemlessonname="#{problem.lessonname}"
                        data-problemmessage="#{problem.message}"
                        data-problemid="#{problem.problemid}"
                        data-problemmoodlename="#{problem.moodlename}"
                        data-problemmoodleid="#{problem.moodleid}"
                        data-problemanswer="#{problem.answer}"
                        data-problemnotificationid="#{problem.notificationid}") Antwort bearbeiten

    div
        div(class="modal fade" id="problemEditModal" tabindex="-1" role="dialog" aria-hidden="true")
            div(class="modal-dialog modal-dialog-centered" role="document")
                div(class="modal-content")
                    div(class="modal-header")
                        h5(class="modal-title") Antworten
                        button(type="button" class="close" data-dismiss="modal" aria-label="Close")
                            span(aria-hidden="true") &times;
                    div(class="modal-body")
                        form(action="/saveAnswerOnProblem" method="post")
                            input(class="editAnswerProblemId" type="hidden" name="problemId")
                            input(class="editAnswerProblemMoodleId" type="hidden" name="moodleId")
                            input(class="editAnswerProblemNotificationId" type="hidden" name="notificationId")
                            div.input
                                span.label(class="formLessonName") Nachrichten Text
                                br
                                span.label(class="formProblemText") Nachrichten Text
                                br
                                textarea(class="formAnswerText" name="answer" value="" required) Text
                            div.actions
                                button(class="btn btn-primary" type="submit") Speichern
                        form(action="/deleteProblem" method="post")
                            input(class="deleteAnswerProblemId" type="hidden" name="problemId")
                            div.actions
                                button(class="btn btn-primary" type="submit") LÃ¶schen

    script.
        $('#problemEditModal').on('show.bs.modal', function (event) {
            let button = $(event.relatedTarget)
            let problemId = button.data('problemid')
            let problemMoodleId = button.data('problemmoodleid')
            let problemMoodleName = button.data('problemmoodlename')
            let problemLessonName = button.data('problemlessonname')
            let problemMessage = button.data('problemmessage')
            let problemNotificationId = button.data('problemnotificationid')
            let problemAnswer = button.data('problemanswer')
            let modal = $(this)
            modal.find('.modal-title').text(problemMoodleName + " Antworten")
            modal.find('.editAnswerProblemId').val(problemId)
            modal.find('.editAnswerProblemMoodleId').val(problemMoodleId)
            modal.find('.editAnswerProblemNotificationId').val(problemNotificationId)
            modal.find('.formLessonName').text('Aufgabe: ' + problemLessonName)
            modal.find('.formProblemText').text('Frage: ' + problemMessage)
            modal.find('.formAnswerText').text(problemAnswer)
            modal.find('.deleteAnswerProblemId').val(problemId)
        })